/*
 * digit.c
 *
 *  Created on: 17.01.2023
 *      Author: graumkli
 */
#include <stdint.h>
#include "lcd.h"

#include "digit.h"

#if 1
// Präprozessor-Anweisung für Folding

// Ziffern 20x32 für die Anzeige der Geschwindigkeit (siehe gfx/digits_speed.png)
static const uint8_t DIGIT_DATA_20x32[] = { 0x0, 0xfe, 0xff, 0x0, 0xc0, 0xff,
        0xff, 0x3, 0xe0, 0xff, 0xff, 0xf, 0xf0, 0xff, 0xff, 0x1f, 0xf8, 0xff,
        0xff, 0x3f, 0xf8, 0xff, 0xff, 0x3f, 0xfc, 0xff, 0xff, 0x7f, 0xfc, 0x0,
        0x0, 0x7e, 0x7c, 0x0, 0x0, 0x7c, 0x7c, 0x0, 0x0, 0x7c, 0x7c, 0x0, 0x0,
        0x7c, 0x7c, 0x0, 0x0, 0x7c, 0xfc, 0x0, 0x0, 0x7e, 0xfc, 0xff, 0xff,
        0x7f, 0xf8, 0xff, 0xff, 0x3f, 0xf8, 0xff, 0xff, 0x3f, 0xf0, 0xff, 0xff,
        0x1f, 0xe0, 0xff, 0xff, 0xf, 0x80, 0xff, 0xff, 0x3, 0x0, 0xfe, 0xff,
        0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0xc0, 0x7, 0x0, 0x0, 0xc0,
        0x7, 0x0, 0x0, 0xe0, 0x3, 0x0, 0x0, 0xe0, 0x3, 0x0, 0x0, 0xe0, 0x3, 0x0,
        0x0, 0xf0, 0x3, 0x0, 0x0, 0xf0, 0x1, 0x0, 0x0, 0xf0, 0xff, 0xff, 0x7f,
        0xf8, 0xff, 0xff, 0x7f, 0xf8, 0xff, 0xff, 0x7f, 0xf8, 0xff, 0xff, 0x7f,
        0xf8, 0xff, 0xff, 0x7f, 0xfc, 0xff, 0xff, 0x7f, 0xfc, 0xff, 0xff, 0x7f,
        0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
        0x0, 0x0, 0x80, 0xf, 0x0, 0x7c, 0xc0, 0xf, 0x0, 0x7e, 0xe0, 0xf, 0x0,
        0x7f, 0xf0, 0xf, 0x80, 0x7f, 0xf8, 0xf, 0xc0, 0x7f, 0xf8, 0xf, 0xe0,
        0x7f, 0xfc, 0x1, 0xf0, 0x7f, 0xfc, 0x0, 0xf8, 0x7f, 0x7c, 0x0, 0xfc,
        0x7f, 0x7c, 0x0, 0xfe, 0x7d, 0x7c, 0x0, 0xff, 0x7c, 0xfc, 0xc0, 0x7f,
        0x7c, 0xfc, 0xf1, 0x3f, 0x7c, 0xfc, 0xff, 0x1f, 0x7c, 0xf8, 0xff, 0xf,
        0x7c, 0xf8, 0xff, 0x7, 0x7c, 0xf0, 0xff, 0x1, 0x7c, 0xe0, 0xff, 0x0,
        0x7c, 0xc0, 0x3f, 0x0, 0x7c, 0x0, 0x6, 0x0, 0x7c, 0xc0, 0x1, 0x80, 0x7,
        0xe0, 0x1, 0x80, 0xf, 0xf0, 0x1, 0x80, 0x1f, 0xf8, 0x1, 0x80, 0x3f,
        0xf8, 0x1, 0x80, 0x3f, 0xf8, 0x1, 0x80, 0x3f, 0xfc, 0xe0, 0x3, 0x7f,
        0xfc, 0xe0, 0x3, 0x7e, 0x7c, 0xe0, 0x3, 0x7c, 0x7c, 0xe0, 0x3, 0x7c,
        0x7c, 0xe0, 0x3, 0x7c, 0x7c, 0xe0, 0x3, 0x7c, 0xfc, 0xf0, 0x7, 0x7e,
        0xfc, 0xff, 0xff, 0x3f, 0xf8, 0xff, 0xff, 0x3f, 0xf8, 0xff, 0xff, 0x3f,
        0xf0, 0x7f, 0xff, 0x1f, 0xf0, 0x3f, 0xfe, 0xf, 0xc0, 0x1f, 0xfe, 0x7,
        0x0, 0x7, 0xf8, 0x3, 0x0, 0x0, 0xf8, 0x1, 0x0, 0x0, 0xfe, 0x1, 0x0, 0x0,
        0xff, 0x1, 0x0, 0xc0, 0xff, 0x1, 0x0, 0xe0, 0xff, 0x1, 0x0, 0xf8, 0xff,
        0x1, 0x0, 0xfe, 0xf7, 0x1, 0x0, 0xff, 0xf1, 0x1, 0xc0, 0x7f, 0xf0, 0x1,
        0xf0, 0x1f, 0xf0, 0x1, 0xf8, 0xf, 0xf0, 0x1, 0xfc, 0xff, 0xff, 0x7f,
        0xfc, 0xff, 0xff, 0x7f, 0xfc, 0xff, 0xff, 0x7f, 0xfc, 0xff, 0xff, 0x7f,
        0xfc, 0xff, 0xff, 0x7f, 0xfc, 0xff, 0xff, 0x7f, 0xfc, 0xff, 0xff, 0x7f,
        0x0, 0x0, 0xf0, 0x1, 0x0, 0x0, 0xf0, 0x1, 0x0, 0x0, 0x80, 0x3, 0x80,
        0xff, 0x81, 0x7, 0xfc, 0xff, 0x83, 0xf, 0xfc, 0xff, 0x83, 0x1f, 0xfc,
        0xff, 0x83, 0x3f, 0xfc, 0xff, 0x83, 0x3f, 0xfc, 0xff, 0x83, 0x7f, 0xfc,
        0xe0, 0x1, 0x7e, 0x7c, 0xf0, 0x1, 0x7c, 0x7c, 0xf0, 0x1, 0x7c, 0x7c,
        0xf0, 0x1, 0x7c, 0x7c, 0xf0, 0x1, 0x7c, 0x7c, 0xf0, 0x3, 0x7e, 0x7c,
        0xf0, 0xff, 0x7f, 0x7c, 0xf0, 0xff, 0x3f, 0x7c, 0xe0, 0xff, 0x3f, 0x7c,
        0xe0, 0xff, 0x1f, 0x7c, 0xc0, 0xff, 0xf, 0x7c, 0x80, 0xff, 0x7, 0x0,
        0x0, 0xfe, 0x1, 0x0, 0xf0, 0xff, 0x0, 0x0, 0xfc, 0xff, 0x3, 0x0, 0xff,
        0xff, 0xf, 0x80, 0xff, 0xff, 0x1f, 0xc0, 0xff, 0xff, 0x1f, 0xe0, 0xff,
        0xff, 0x3f, 0xf0, 0xff, 0xff, 0x3f, 0xf0, 0xef, 0x3, 0x7e, 0xf8, 0xe3,
        0x1, 0x7c, 0xf8, 0xf1, 0x1, 0x7c, 0xf8, 0xf0, 0x1, 0x7c, 0xfc, 0xf0,
        0x1, 0x7c, 0x7c, 0xf0, 0x3, 0x7e, 0x7c, 0xf0, 0x7, 0x7f, 0x7c, 0xf0,
        0xff, 0x3f, 0x7c, 0xe0, 0xff, 0x3f, 0x0, 0xe0, 0xff, 0x1f, 0x0, 0xc0,
        0xff, 0x1f, 0x0, 0x80, 0xff, 0xf, 0x0, 0x0, 0xff, 0x3, 0x7c, 0x0, 0x0,
        0x0, 0x7c, 0x0, 0x0, 0x0, 0x7c, 0x0, 0x0, 0x40, 0x7c, 0x0, 0x0, 0x70,
        0x7c, 0x0, 0x0, 0x7c, 0x7c, 0x0, 0x80, 0x7f, 0x7c, 0x0, 0xe0, 0x7f,
        0x7c, 0x0, 0xf8, 0x7f, 0x7c, 0x0, 0xfe, 0x7f, 0x7c, 0x80, 0xff, 0x3f,
        0x7c, 0xf0, 0xff, 0xf, 0x7c, 0xfc, 0xff, 0x3, 0x7c, 0xff, 0x7f, 0x0,
        0xfc, 0xff, 0x1f, 0x0, 0xfc, 0xff, 0x3, 0x0, 0xfc, 0xff, 0x0, 0x0, 0xfc,
        0x3f, 0x0, 0x0, 0xfc, 0x7, 0x0, 0x0, 0xfc, 0x1, 0x0, 0x0, 0x7c,0x0,
        0x0, 0x0, 0x0, 0x0,
        0x0, 0x0, 0x0, 0x7, 0xf8, 0x3, 0xc0, 0x1f, 0xfc, 0xf, 0xf0, 0x3f, 0xfe,
        0x1f, 0xf0, 0x7f, 0xff, 0x1f, 0xf8, 0xff, 0xff, 0x3f, 0xf8, 0xff, 0xff,
        0x3f, 0xfc, 0xff, 0xff, 0x7f, 0xfc, 0xf0, 0x7, 0x7e, 0x7c, 0xe0, 0x3,
        0x7c, 0x7c, 0xe0, 0x3, 0x7c, 0x7c, 0xe0, 0x3, 0x7c, 0x7c, 0xe0, 0x3,
        0x7c, 0xfc, 0xf0, 0x7, 0x7e, 0xfc, 0xff, 0xff, 0x7f, 0xf8, 0xff, 0xff,
        0x3f, 0xf8, 0xff, 0xff, 0x3f, 0xf0, 0x7f, 0xff, 0x1f, 0xf0, 0x3f, 0xfe,
        0x1f, 0xc0, 0x1f, 0xfc, 0xf, 0x0, 0xff, 0x1, 0x0, 0xc0, 0xff, 0x7, 0x0,
        0xe0, 0xff, 0xf, 0x0, 0xf0, 0xff, 0x1f, 0x0, 0xf8, 0xff, 0x1f, 0x7c,
        0xf8, 0xff, 0x3f, 0x7c, 0xfc, 0xc7, 0x3f, 0x7c, 0xfc, 0x0, 0x3f, 0x7c,
        0x7c, 0x0, 0x3e, 0x7e, 0x7c, 0x0, 0x3e, 0x3e, 0x7c, 0x0, 0x3e, 0x3e,
        0xfc, 0x0, 0x1e, 0x3f, 0xfc, 0x1, 0xdf, 0x1f, 0xf8, 0xff, 0xff, 0x1f,
        0xf8, 0xff, 0xff, 0xf, 0xf0, 0xff, 0xff, 0x7, 0xe0, 0xff, 0xff, 0x3,
        0xc0, 0xff, 0xff, 0x1, 0x80, 0xff, 0x7f, 0x0, 0x0, 0xfc, 0xf, 0x0, 0x0,
        0x0, 0x0, 0x0 };

static const uint8_t DIGIT_DATA_12x16[] = {0xf8, 0x1f, 0xfc, 0x3f, 0xfe, 0x7f,
       0xfe, 0x7f, 0x86, 0x67, 0x86, 0x67, 0xe6, 0x61, 0xe6, 0x61, 0xfe, 0x7f,
       0xfe, 0x7f, 0xfc, 0x3f, 0xf8, 0x1f, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
       0x0, 0x60, 0x60, 0x70, 0x60, 0x38, 0x60, 0x1c, 0x60, 0xfe, 0x7f, 0xfe,
       0x7f, 0xfe, 0x7f, 0xfe, 0x7f, 0x0, 0x60, 0x0, 0x60, 0x0, 0x60, 0x0,
       0x60, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x38, 0x60, 0x3c, 0x70,
       0x3e, 0x78, 0x1e, 0x7c, 0xe, 0x7e, 0xe, 0x7f, 0x8e, 0x6f, 0xde, 0x67,
       0xfe, 0x63, 0xfe, 0x61, 0xfc, 0x60, 0x78, 0x60, 0x0, 0x0, 0x0, 0x0, 0x0,
       0x0, 0x0, 0x0, 0x18, 0x18, 0x1c, 0x38, 0xe, 0x70, 0x6, 0x60, 0x86, 0x61,
       0x86, 0x61, 0x8e, 0x71, 0xde, 0x7b, 0xfe, 0x7f, 0xfe, 0x7f, 0xfc, 0x3f,
       0x78, 0x1e, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x80, 0x3, 0xc0, 0x7,
       0xe0, 0x7, 0x70, 0x6, 0x38, 0x6, 0x1c, 0x6, 0xe, 0x6, 0x6, 0x6, 0xfe, 0x7f,
       0xfe, 0x7f, 0xfe, 0x7f, 0xfe, 0x7f, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
       0x3c, 0x3c, 0x7e, 0x7c, 0x7e, 0x78, 0x7e, 0x70, 0x66, 0x60, 0x66, 0x60, 0xe6,
       0x60, 0xe6, 0x61, 0xe6, 0x7f, 0xe6, 0x7f, 0xc6, 0x3f, 0x86, 0x1f, 0x0, 0x0,
       0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0xf8, 0x1f, 0xfc, 0x3f, 0xfe, 0x7f, 0xce, 0x7f,
       0x86, 0x61, 0x86, 0x61, 0x86, 0x61, 0x86, 0x61, 0x86, 0x7f, 0x8e, 0x7f, 0x1c,
       0x3f, 0x18, 0x1e, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x6, 0x70, 0x6, 0x78,
       0x6, 0x3c, 0x6, 0x1e, 0x6, 0xf, 0x86, 0x7, 0xc6, 0x3, 0xe6, 0x1, 0xfe, 0x0, 0x7e,
       0x0, 0x3e, 0x0, 0x1e, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x78, 0x1e,
       0xfc, 0x3f, 0xfe, 0x7f, 0xfe, 0x7f, 0xce, 0x73, 0x86, 0x61, 0x86, 0x61, 0xce, 0x73,
       0xfe, 0x7f, 0xfe, 0x7f, 0xfc, 0x3f, 0x78, 0x1e, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
       0x0, 0x78, 0x18, 0xfc, 0x38, 0xfe, 0x71, 0xfe, 0x61, 0xce, 0x61, 0x86, 0x61, 0x86,
       0x71, 0xce, 0x79, 0xfe, 0x7f, 0xfe, 0x7f, 0xfc, 0x3f, 0xf8, 0x1f};

static const uint8_t DIGIT_DATA_6x8[] = {0x3e, 0x7f, 0x59, 0x4d, 0x7f, 0x3e, 0x0, 0x0,
       0x44, 0x42, 0x7f, 0x7f, 0x40, 0x40, 0x0, 0x0, 0x42, 0x61, 0x71, 0x59, 0x4f, 0x46,
       0x0, 0x0, 0x22, 0x41, 0x49, 0x49, 0x7f, 0x36, 0x0, 0x0, 0x18, 0x1c, 0x12, 0x11,
       0x7f, 0x7f, 0x0, 0x0, 0x27, 0x47, 0x45, 0x45, 0x7d, 0x39, 0x0, 0x0, 0x3e, 0x7f,
       0x49, 0x49, 0x79, 0x32, 0x0, 0x0, 0x61, 0x71, 0x19, 0xd, 0x7, 0x3, 0x0, 0x0, 0x36,
       0x7f, 0x49, 0x49, 0x7f, 0x36, 0x0, 0x0, 0x26, 0x4f, 0x49, 0x49, 0x7f, 0x3e};
#endif

/**
 * @brief Zeichnen einer 20x32 Ziffer
 * @param x Angabe der x-Position, an welcher die Ziffer stehen soll
 * @param y_page Angabe der y-Page, an welcher die Ziffer stehen soll
 * @param digit Ziffer, welche angezeigt werden soll
 */
void digit_draw_20x32(uint8_t x, uint8_t y_page, uint8_t digit) {
    const uint8_t *pt = &(DIGIT_DATA_20x32[20 * 4 * digit]);

    for (uint8_t i = 0; i < 20; i++) {
        for (uint8_t y = 0; y < 4; y++) {
            lcd_set_pixels(x + i, y_page + y, ~(*pt));
            pt++;
        }
    }
}

/**
 * @brief Zeichnen einer 12x16 Ziffer
 * @param x Angabe der x-Position, an welcher die Ziffer stehen soll
 * @param y_page Angabe der y-Page, an welcher die Ziffer stehen soll
 * @param digit Ziffer, welche angezeigt werden soll
 */
void digit_draw_12x16(uint8_t x, uint8_t y_page, uint8_t digit) {
    const uint8_t *pt = &(DIGIT_DATA_12x16[16 * 2 * digit]);

    for (uint8_t i = 0; i < 12; i++) {
        for (uint8_t y = 0; y < 2; y++) {
            lcd_set_pixels(x + i, y_page + y, ~(*pt));
            pt++;
        }
    }
}

/**
 * @brief Zeichnen einer 6x8 Ziffer
 * @param x Angabe der x-Position, an welcher die Ziffer stehen soll
 * @param y_page Angabe der y-Page, an welcher die Ziffer stehen soll
 * @param digit Ziffer, welche angezeigt werden soll
 */
void digit_draw_6x8(uint8_t x, uint8_t y_page, uint8_t digit) {
    const uint8_t *pt = &(DIGIT_DATA_6x8[8 * digit]);
    for (uint8_t i = 0; i < 6; i++) {
        for (uint8_t y = 0; y < 1; y++) {
            lcd_set_pixels(x + i, y_page + y, ~(*pt));
            pt++;
        }
    }
}

/**
 * @brief Zeichnen einer invertierten 6x8 Ziffer
 * @param x Angabe der x-Position, an welcher die Ziffer stehen soll
 * @param y_page Angabe der y-Page, an welcher die Ziffer stehen soll
 * @param digit Ziffer, welche angezeigt werden soll
 */
void digit_draw_6x8_invert(uint8_t x, uint8_t y_page, uint8_t digit) {
    const uint8_t *pt = &(DIGIT_DATA_6x8[8 * digit]);
    for (uint8_t i = 0; i < 6; i++) {
        for (uint8_t y = 0; y < 1; y++) {
            lcd_set_pixels(x + i, y_page + y, *pt);
            pt++;
        }
    }
}

/**
 * @brief Löschen des Bereiches einer 20x32 Ziffer
 * @param x Angabe der x-Position, an welcher die Ziffer gelöscht werden soll
 * @param y_page Angabe der y-Page, an welcher die Ziffer gelöscht werden soll
 */
void digit_clear_20x32(uint8_t x, uint8_t y_page) {
    for (uint8_t i = 0; i < 20; i++) {
        for (uint8_t y = 0; y < 4; y++) {
            lcd_set_pixels(x + i, y_page + y, 0xFF);
        }
    }
}

/**
 * @brief Löschen des Bereiches einer 12x16 Ziffer
 * @param x Angabe der x-Position, an welcher die Ziffer gelöscht werden soll
 * @param y_page Angabe der y-Page, an welcher die Ziffer gelöscht werden soll
 */
void digit_clear_12x16(uint8_t x, uint8_t y_page) {
    for (uint8_t i = 0; i < 12; i++) {
        for (uint8_t y = 0; y < 2; y++) {
            lcd_set_pixels(x + i, y_page + y, 0xFF);
        }
    }
}

/**
 * @brief Löschen des Bereiches einer 6x8 Ziffer
 * @param x Angabe der x-Position, an welcher die Ziffer gelöscht werden soll
 * @param y_page Angabe der y-Page, an welcher die Ziffer gelöscht werden soll
 */
void digit_clear_6x8(uint8_t x, uint8_t y_page) {
    for (uint8_t i = 0; i < 6; i++) {
        for (uint8_t y = 0; y < 1; y++) {
            lcd_set_pixels(x + i, y_page + y, 0xFF);
        }
    }
}

/**
 * @brief Zeichnen einer Zahl in Größe 6x8 mit maximal 5 Ziffern
 * @param x Angabe der x-Position, an welcher die Ziffer stehen soll
 * @param y_page Angabe der y-Page, an welcher die Ziffer stehen soll
 * @param nummer Zahl, welche angezeigt werden soll
 * @param digit_count Anzahl an beinhalteten Ziffern
 * @param leading_zeros Angabe, ob führende Nullen angezeigt werden sollen
 * @param stelle_invert Die Position der vorzuhebenden Ziffer
 */
void draw_number_6x8(uint8_t x, uint8_t y_page, uint32_t number,
        uint8_t digit_count, uint8_t leading_zeros, uint8_t stelle_invert) {
    int Array[5]; // Festlegung: Maximal 5 Stellen

    // Zeichenkette erstellen
    for (uint8_t digit = 0; digit < digit_count; digit++) {
        uint32_t c = number % 10;
        Array[digit_count - digit - 1] = c;
        number /= 10;
    }

    // Führende Nullen entfernen
    if (!leading_zeros) {
        for (uint8_t digit = 0; digit < digit_count - 1; digit++) {
            if (Array[digit] == 0) {
                Array[digit] = 99;
            } else {
                break;
            }
        }
    }

    // Anzeigen
    for (uint8_t digit = 0; digit < digit_count; digit++) {
        if(Array[digit]==99);
        else if(stelle_invert-1!=digit)
            digit_draw_6x8(x, y_page, Array[digit]);
        else if(stelle_invert-1==digit)
            digit_draw_6x8_invert(x, y_page, Array[digit]);
            x += 7;
    }
}

