/*
 * start.c
 *
 *  Created on: 19.01.2023
 *      Author: graumkli
 */

#include <stdint.h>
#include "C:\Users\GRAUMKLI\Desktop\Studienarbeit 2\CSS Projekt\Displaysteuerung\LCD\lcd.h"
#include "C:\Users\GRAUMKLI\Desktop\Studienarbeit 2\CSS Projekt\Displaysteuerung\LCD\digit.h"
#include "C:\Users\GRAUMKLI\Desktop\Studienarbeit 2\CSS Projekt\Displaysteuerung\Displayanzeige\settings.h"

#include "C:\Users\GRAUMKLI\Desktop\Studienarbeit 2\CSS Projekt\Signalauswertung\dynamoauswertung.h"

#include "start.h"


static const uint8_t SPEED_VALUE_Y1 = 2;     // Y-Page der Anzeige
static const uint8_t SPEED_VALUE_Y2 = 4;     // Y-Page der Anzeige
static const uint8_t SPEED_VALUE_X_1 = 1;   // X-Position der 1. Ziffer
static const uint8_t SPEED_VALUE_X_2 = 23;  // X-Position der 2. Ziffer
static const uint8_t SPEED_VALUE_X_3 = 47;  // X-Position der 3. Ziffer

static const uint8_t DIST_VALUE_Y1 = 2;     // Y-Page der Anzeige
static const uint8_t DIST_VALUE_Y2 = 3;     // Y-Page der Anzeige
static const uint8_t DIST_VALUE_Y3 = 4;     // Y-Page der Anzeige
static const uint8_t DIST_VALUE_X_1 = 63;   // X-Position der 1. Ziffer
static const uint8_t DIST_VALUE_X_2 = 63;  // X-Position der 2. Ziffer
static const uint8_t DIST_VALUE_X_3 = 63;  // X-Position der 3. Ziffer

static const uint8_t TIME_VALUE_Y1 = 7;     // Y-Page der Anzeige
static const uint8_t TIME_VALUE_X_1 = 66;   // X-Position der 1. Ziffer


#if 1
// Präprozessor-Anweisung für Folding

static const uint8_t START_DISPLAY_DATA[] = {0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0x8f, 0xfb, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0x7, 0xf3, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0x77, 0xf7, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0x77, 0xf7, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0x67, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0xef, 0xf8, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x1f, 0xc0,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfb,
                                             0x7, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf5,
                                             0x7, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xee,
                                             0x77, 0xff, 0xff, 0xff, 0xff, 0xff, 0x7f, 0xdf,
                                             0x77, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0x7, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0x8f, 0xff, 0xff, 0xff, 0xff, 0xff, 0x7f, 0xc0,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x7f, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x7f, 0xff,
                                             0x7, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0,
                                             0x7, 0xf0, 0xff, 0xff, 0xff, 0xff, 0x7f, 0xff,
                                             0x77, 0xf7, 0xff, 0xff, 0xff, 0xff, 0x7f, 0xff,
                                             0x77, 0xf7, 0xff, 0xff, 0xff, 0xff, 0xff, 0xc0,
                                             0xf7, 0xf7, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0xf7, 0xf7, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xc7,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8,
                                             0x7, 0xf0, 0xff, 0xff, 0xff, 0xff, 0x1f, 0xff,
                                             0x7, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0x77, 0xf7, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0x77, 0xf7, 0xff, 0xff, 0xff, 0xff, 0x1f, 0xc0,
                                             0xf7, 0xf7, 0xff, 0xff, 0xff, 0xff, 0x7f, 0xff,
                                             0xf7, 0xf7, 0xff, 0xff, 0xff, 0xff, 0x7f, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x7f, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xc0,
                                             0x7, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0x7, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0xf7, 0xf7, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0xf7, 0xf7, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0x7, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0xf, 0xf8, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                                             0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xfb, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xfb, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xfb, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xfb, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xfb, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xfb, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xeb, 0xff, 0xff,
                                             0x7, 0xf0, 0xff, 0xff, 0xff, 0xeb, 0xff, 0xff,
                                             0x7, 0xf0, 0xff, 0xff, 0xff, 0xb, 0xe0, 0xff,
                                             0xf7, 0xf7, 0xff, 0xff, 0xff, 0xb, 0xe0, 0xff,
                                             0xf7, 0xf7, 0xff, 0xff, 0xff, 0xeb, 0xff, 0xff,
                                             0x7, 0xf0, 0xff, 0xff, 0xff, 0xeb, 0xff, 0xff,
                                             0xf, 0xf8, 0xff, 0xff, 0xff, 0xfb, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xfb, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xfb, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xb, 0xe0, 0xff,
                                             0x7, 0xf0, 0xff, 0xff, 0xff, 0xb, 0xe0, 0xff,
                                             0x7, 0xf0, 0xff, 0xff, 0xff, 0xfb, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xfb, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xfb, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xb, 0xe0, 0xff,
                                             0x8f, 0xfb, 0xff, 0xff, 0xff, 0xb, 0xe0, 0xff,
                                             0x7, 0xf3, 0xff, 0xff, 0xff, 0x3b, 0xff, 0xff,
                                             0x77, 0xf7, 0xff, 0xff, 0xff, 0x7b, 0xfe, 0xff,
                                             0x77, 0xf7, 0xff, 0xff, 0xff, 0x3b, 0xff, 0xff,
                                             0x67, 0xf0, 0xff, 0xff, 0xff, 0xb, 0xe0, 0xff,
                                             0xef, 0xf8, 0xff, 0xff, 0xff, 0xb, 0xe0, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xfb, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xfb, 0xff, 0xff,
                                             0xf7, 0xff, 0xff, 0xff, 0xff, 0xb, 0xe0, 0xff,
                                             0xf7, 0xff, 0xff, 0xff, 0xff, 0xb, 0xe0, 0xff,
                                             0x7, 0xf0, 0xff, 0xff, 0xff, 0xeb, 0xee, 0xff,
                                             0x7, 0xf0, 0xff, 0xff, 0xff, 0xeb, 0xee, 0xff,
                                             0xf7, 0xff, 0xff, 0xff, 0xff, 0xeb, 0xef, 0xff,
                                             0xf7, 0xff, 0xff, 0xff, 0xff, 0xeb, 0xef, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xfb, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xfb, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xfb, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xfb, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xfb, 0xff, 0xff,
                                             0xff, 0xff, 0xff, 0xff, 0xff, 0xfb, 0xff, 0xff};

#endif

/**
 * @brief Ausgangsfunktion zum Anzeigen der Startseite
 */
void draw_start_display() {
    const uint8_t *pt = &(START_DISPLAY_DATA[0]);
    for (uint8_t x = 0; x < LCD_X_SIZE; x++) {
        for (uint8_t y = 0; y < LCD_Y_SIZE_PAGES; y++) {
            lcd_set_pixels(x, y, *pt);
            pt++;
        }
    }
    digit_draw_6x8(DIST_VALUE_X_1, DIST_VALUE_Y1,1);
    lcd_set_pixels(DIST_VALUE_X_1+7, DIST_VALUE_Y1, 0x99);
    lcd_set_pixels(DIST_VALUE_X_1+8, DIST_VALUE_Y1, 0x99);

    digit_draw_6x8(DIST_VALUE_X_2, DIST_VALUE_Y2,2);
    lcd_set_pixels(DIST_VALUE_X_2+7, DIST_VALUE_Y2, 0x99);
    lcd_set_pixels(DIST_VALUE_X_2+8, DIST_VALUE_Y2, 0x99);

    digit_draw_6x8(DIST_VALUE_X_3, DIST_VALUE_Y3,3);
    lcd_set_pixels(DIST_VALUE_X_3+7, DIST_VALUE_Y3, 0x99);
    lcd_set_pixels(DIST_VALUE_X_3+8, DIST_VALUE_Y3, 0x99);

    lcd_set_pixels(TIME_VALUE_X_1+15, TIME_VALUE_Y1, 0x99);
    lcd_set_pixels(TIME_VALUE_X_1+16, TIME_VALUE_Y1, 0x99);

    draw_start();
}

/**
 * @brief Schreibt alle Werte auf die Startseite
 */
void draw_start(){
    speed_draw();
    dist_draw();
    time_draw();
}

/**
 * @brief Schreibt die aktuelle Geschwindigkeit auf die Startseite
 */
void speed_draw(){
    // Anzeige der ersten Ziffer
    uint8_t first_digit = Settings.Speed.Vorkomma / 10;
    if (first_digit > 0 && first_digit <= 9) {
        digit_draw_20x32(SPEED_VALUE_X_1, SPEED_VALUE_Y1, first_digit);
    } else {
        digit_clear_20x32(SPEED_VALUE_X_1, SPEED_VALUE_Y1);
    }

    // Zweite Ziffer
    digit_draw_20x32(SPEED_VALUE_X_2, SPEED_VALUE_Y1, Settings.Speed.Vorkomma % 10);

    // Nachkomma
    digit_draw_12x16(SPEED_VALUE_X_3, SPEED_VALUE_Y2, Settings.Speed.Nachkomma);
}

/**
 * @brief Schreibt die aktuellen Distanzen auf die Startseite
 */
void dist_draw(){
    draw_number_6x8(DIST_VALUE_X_1+10, DIST_VALUE_Y1, Settings.Distanz.Gesamt, 4, 1, 0);
    draw_number_6x8(DIST_VALUE_X_2+10, DIST_VALUE_Y2, Settings.Distanz.Tour, 4, 0, 0);
    draw_number_6x8(DIST_VALUE_X_3+10, DIST_VALUE_Y3, Settings.Distanz.Tag, 4, 0, 0);
}

/**
 * @brief Schreibt die aktuelle Zeit auf die Startseite
 */
void time_draw(){
    // Anzeige der ersten Ziffer
    uint8_t first_digit = Settings.Uhrzeit.Stunde / 10;
    digit_draw_6x8(TIME_VALUE_X_1, TIME_VALUE_Y1,first_digit);

    // Zweite Ziffer
    digit_draw_6x8(TIME_VALUE_X_1+7, TIME_VALUE_Y1, Settings.Uhrzeit.Stunde % 10);

    first_digit = Settings.Uhrzeit.Minute / 10;
    digit_draw_6x8(TIME_VALUE_X_1+19, TIME_VALUE_Y1,first_digit);

    // Zweite Ziffer
    digit_draw_6x8(TIME_VALUE_X_1+26, TIME_VALUE_Y1, Settings.Uhrzeit.Minute % 10);
}
